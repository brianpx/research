l<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Resident and Medical Student Research Opportunities</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Inter', sans-serif; }
    .modal        { transition: opacity 0.25s ease; }
    .modal-content{ transition: transform 0.25s ease; }

    /* Sticky filter bar */
    .sticky-filters {
      position: sticky;
      top: 0;
      z-index: 40;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      background: rgba(243,244,246,0.92);
      border-bottom: 1px solid #e5e7eb;
    }

    /* Dropdown panel */
    .dropdown-panel {
      display: none;
      position: absolute;
      top: calc(100% + 4px);
      left: 0;
      min-width: 100%;
      z-index: 50;
    }
    .dropdown-panel.open { display: block; }

    /* Fixed-width table */
    #projectTable {
      table-layout: fixed;
      width: 100%;
    }

    /* Custom scrollbar */
    .modal-body::-webkit-scrollbar { width: 8px; }
    .modal-body::-webkit-scrollbar-track { background: #f1f1f1; }
    .modal-body::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
    .modal-body::-webkit-scrollbar-thumb:hover { background: #555; }

    /* Confirmation animation */
    @keyframes checkDraw {
      0%   { stroke-dashoffset: 48; }
      100% { stroke-dashoffset: 0; }
    }
    .check-animated path {
      stroke-dasharray: 48;
      stroke-dashoffset: 48;
      animation: checkDraw 0.5s ease-out 0.2s forwards;
    }
    @keyframes scaleIn {
      0%   { transform: scale(0); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }
    .confirm-icon { animation: scaleIn 0.3s ease-out forwards; }
  </style>
</head>

<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col">

<!-- ════════════════════ HEADER ════════════════════ -->
<div class="container mx-auto px-4 sm:px-6 pt-6 pb-2">
  <header class="text-center mb-4">
    <h1 class="text-2xl sm:text-3xl font-bold text-gray-900">Resident and Medical Student Research Opportunities</h1>
    <p class="text-gray-600 mt-1 text-sm sm:text-base">Browse available projects and apply directly –
      <span class="text-amber-600 font-medium">Demo Purposes Only</span>
    </p>
  </header>
</div>

<!-- ════════════════════ STICKY FILTERS ════════════════════ -->
<div class="sticky-filters">
  <div class="container mx-auto px-4 sm:px-6 py-3">
    <div class="bg-white rounded-lg shadow-sm p-3 grid grid-cols-1 sm:grid-cols-3 gap-3">

      <!-- Live search -->
      <input id="searchInput" type="text"
             placeholder="Search projects…"
             class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none">

      <!-- Project-type dropdown -->
      <div class="relative" id="typeDropdownWrap">
        <button type="button" id="typeTrigger"
                class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm text-left bg-white hover:bg-gray-50 flex justify-between items-center">
          <span id="typeLabel" class="truncate">All Project Types</span>
          <svg class="w-4 h-4 text-gray-500 shrink-0 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div id="typeDropdown" class="dropdown-panel bg-white border border-gray-200 rounded-lg shadow-lg p-3 space-y-2">
          <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-gray-50 px-1 rounded">
            <input type="checkbox" class="typeCheck h-4 w-4 text-blue-600 rounded border-gray-300" value="Research" checked> Research
          </label>
          <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-gray-50 px-1 rounded">
            <input type="checkbox" class="typeCheck h-4 w-4 text-blue-600 rounded border-gray-300" value="QI" checked> QI
          </label>
          <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-gray-50 px-1 rounded">
            <input type="checkbox" class="typeCheck h-4 w-4 text-blue-600 rounded border-gray-300" value="Edu/Res" checked> Edu/Res
          </label>
          <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-gray-50 px-1 rounded">
            <input type="checkbox" class="typeCheck h-4 w-4 text-blue-600 rounded border-gray-300" value="Clinical Trial" checked> Clinical Trial
          </label>
          <div class="border-t pt-2 mt-1 flex gap-2 text-xs">
            <button type="button" onclick="setAll('typeCheck',true)"  class="text-blue-600 hover:underline">Select all</button>
            <span class="text-gray-300">|</span>
            <button type="button" onclick="setAll('typeCheck',false)" class="text-blue-600 hover:underline">Clear</button>
          </div>
        </div>
      </div>

      <!-- Status dropdown -->
      <div class="relative" id="statusDropdownWrap">
        <button type="button" id="statusTrigger"
                class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm text-left bg-white hover:bg-gray-50 flex justify-between items-center">
          <span id="statusLabel" class="truncate">All Statuses</span>
          <svg class="w-4 h-4 text-gray-500 shrink-0 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
        </button>
        <div id="statusDropdown" class="dropdown-panel bg-white border border-gray-200 rounded-lg shadow-lg p-3 space-y-2">
          <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-gray-50 px-1 rounded">
            <input type="checkbox" class="statusCheck h-4 w-4 text-blue-600 rounded border-gray-300" value="Active" checked> Active
          </label>
          <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-gray-50 px-1 rounded">
            <input type="checkbox" class="statusCheck h-4 w-4 text-blue-600 rounded border-gray-300" value="Planning" checked> Planning
          </label>
          <label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-gray-50 px-1 rounded">
            <input type="checkbox" class="statusCheck h-4 w-4 text-blue-600 rounded border-gray-300" value="Completed" checked> Completed
          </label>
          <div class="border-t pt-2 mt-1 flex gap-2 text-xs">
            <button type="button" onclick="setAll('statusCheck',true)"  class="text-blue-600 hover:underline">Select all</button>
            <span class="text-gray-300">|</span>
            <button type="button" onclick="setAll('statusCheck',false)" class="text-blue-600 hover:underline">Clear</button>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- ════════════════════ MAIN CONTENT ════════════════════ -->
<div class="container mx-auto px-4 sm:px-6 py-4 flex-1">

  <!-- ── DESKTOP TABLE (hidden on mobile) ── -->
  <div class="bg-white rounded-lg shadow overflow-x-auto hidden md:block">
    <table id="projectTable" class="divide-y divide-gray-200">
      <colgroup>
        <col style="width:22%">  <!-- Project -->
        <col style="width:14%">  <!-- Faculty -->
        <col style="width:11%">  <!-- Trainees -->
        <col style="width:8%">   <!-- Type -->
        <col style="width:7%">   <!-- Status -->
        <col style="width:24%">  <!-- Description -->
        <col style="width:8%">   <!-- Slots -->
        <col style="width:6%">   <!-- Action -->
      </colgroup>
      <thead class="bg-gray-50">
        <tr>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Project</th>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Faculty</th>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Trainees</th>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
          <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
          <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Slots</th>
          <th class="px-4 py-3"></th>
        </tr>
      </thead>
      <tbody id="table-body-desktop" class="bg-white divide-y divide-gray-200"></tbody>
    </table>
    <div id="no-results-desktop" class="hidden text-center p-8 text-gray-500">
      <p class="text-lg font-semibold">No projects found</p>
      <p class="text-sm">Try adjusting your search or filter criteria.</p>
    </div>
  </div>

  <!-- ── MOBILE CARDS (hidden on desktop) ── -->
  <div id="card-container" class="md:hidden space-y-3"></div>
  <div id="no-results-mobile" class="hidden md:hidden text-center p-8 text-gray-500">
    <p class="text-lg font-semibold">No projects found</p>
    <p class="text-sm">Try adjusting your search or filter criteria.</p>
  </div>
</div>

<!-- ════════════════════ FOOTER ════════════════════ -->
<footer class="mt-auto border-t border-gray-200">
  <div class="container mx-auto px-4 sm:px-6 py-4 text-center text-sm text-gray-500">
    Created by Brian Pitts, MD, MS, MEHP &middot; Department of Anesthesiology and Pain Medicine &middot; UC Davis Health
  </div>
</footer>

<!-- ════════════════════ APPLY MODAL ════════════════════ -->
<div id="signupModal"
     class="modal fixed inset-0 bg-black bg-opacity-60 hidden opacity-0 flex items-center justify-center p-4 z-50">
  <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-4xl transform -translate-y-10 flex flex-col"
       style="max-height:90vh">

    <!-- Header -->
    <div id="modalHeader" class="flex justify-between items-center p-4 sm:p-6 border-b">
      <div class="min-w-0 flex-1 mr-4">
        <h2 class="text-xl sm:text-2xl font-bold text-gray-900">Resident and Medical Student Research Application</h2>
        <p id="modalProjectTitle" class="text-sm text-blue-700 font-semibold mt-1 truncate"></p>
      </div>
      <button id="closeModal" class="text-gray-400 hover:text-gray-800 text-3xl leading-none shrink-0">&times;</button>
    </div>

    <!-- Form View -->
    <form id="signupForm" class="modal-body overflow-y-auto p-4 sm:p-6 space-y-8">
      <input type="hidden" id="projectTitleInput" name="projectTitle">

      <!-- Personal Information -->
      <fieldset>
        <legend class="text-lg font-semibold text-gray-800 mb-4">Personal Information</legend>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
            <input name="fullName" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
            <input type="email" name="email" required class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
            <input name="phone" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">School and Year</label>
            <input name="schoolYear" placeholder="e.g., UC Davis, MS2" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Available Hours/Week</label>
            <input name="hoursPerWeek" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Preferred Duration</label>
            <input name="duration" placeholder="e.g., 3 months" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Today's Date</label>
            <input type="date" name="date" class="w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-50 focus:ring-blue-500 focus:border-blue-500">
          </div>
        </div>
      </fieldset>

      <!-- Academic Goals -->
      <fieldset class="border-t pt-6">
        <legend class="text-lg font-semibold text-gray-800 mb-4">Academic and Career Goals</legend>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Intended specialty</label>
            <input name="specialty" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Long-term goals (match strategy, publication, presentation)</label>
            <textarea name="longTermGoals" rows="3" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
          </div>
        </div>
      </fieldset>

      <!-- Past Experience -->
      <fieldset class="border-t pt-6">
        <legend class="text-lg font-semibold text-gray-800 mb-4">Past Experience</legend>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Clinical research</label>
            <textarea name="clinicalResearch" rows="3" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">QI or audit</label>
            <textarea name="qiAudit" rows="3" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Technical skills (Python, R, stats, survey tools)</label>
            <textarea name="technicalSkills" rows="3" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Prior presentations / publications</label>
            <textarea name="publications" rows="3" class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
          </div>
        </div>
      </fieldset>

      <!-- Preferences -->
      <div class="border-t pt-6 grid grid-cols-1 sm:grid-cols-2 gap-8">
        <fieldset>
          <legend class="text-lg font-semibold text-gray-800 mb-3">Project Preferences</legend>
          <div class="space-y-2">
            <label class="flex items-center gap-2 text-sm"><input type="checkbox" name="preferences" value="Airway" class="h-4 w-4 text-blue-600 rounded border-gray-300"> Airway</label>
            <label class="flex items-center gap-2 text-sm"><input type="checkbox" name="preferences" value="PACU" class="h-4 w-4 text-blue-600 rounded border-gray-300"> PACU</label>
            <label class="flex items-center gap-2 text-sm"><input type="checkbox" name="preferences" value="Neurology/neuroanesthesia" class="h-4 w-4 text-blue-600 rounded border-gray-300"> Neurology / neuroanesthesia</label>
            <label class="flex items-center gap-2 text-sm"><input type="checkbox" name="preferences" value="AI/data science" class="h-4 w-4 text-blue-600 rounded border-gray-300"> AI / data science</label>
            <label class="flex items-center gap-2 text-sm"><input type="checkbox" name="preferences" value="Curriculum development" class="h-4 w-4 text-blue-600 rounded border-gray-300"> Curriculum development</label>
            <label class="flex items-center gap-2 text-sm"><input type="checkbox" name="preferences" value="Health equity" class="h-4 w-4 text-blue-600 rounded border-gray-300"> Health equity</label>
          </div>
        </fieldset>
        <fieldset>
          <legend class="text-lg font-semibold text-gray-800 mb-3">Preferred Deliverables</legend>
          <div class="space-y-2">
            <label class="flex items-center gap-2 text-sm"><input type="checkbox" name="deliverables" value="Poster" class="h-4 w-4 text-blue-600 rounded border-gray-300"> Poster</label>
            <label class="flex items-center gap-2 text-sm"><input type="checkbox" name="deliverables" value="Abstract" class="h-4 w-4 text-blue-600 rounded border-gray-300"> Abstract</label>
            <label class="flex items-center gap-2 text-sm"><input type="checkbox" name="deliverables" value="Manuscript" class="h-4 w-4 text-blue-600 rounded border-gray-300"> Manuscript</label>
            <label class="flex items-center gap-2 text-sm"><input type="checkbox" name="deliverables" value="Tool/curriculum" class="h-4 w-4 text-blue-600 rounded border-gray-300"> Tool / curriculum</label>
          </div>
        </fieldset>
      </div>

      <div class="border-t pt-6 grid grid-cols-1 sm:grid-cols-2 gap-8">
        <fieldset>
          <legend class="text-lg font-semibold text-gray-800 mb-3">Supervision Preference</legend>
          <div class="space-y-2">
            <label class="flex items-center gap-2 text-sm"><input type="radio" name="supervision" value="Weekly meetings" class="h-4 w-4 text-blue-600 border-gray-300"> Weekly meetings</label>
            <label class="flex items-center gap-2 text-sm"><input type="radio" name="supervision" value="Occasional check-ins" class="h-4 w-4 text-blue-600 border-gray-300"> Occasional check-ins</label>
          </div>
        </fieldset>
        <fieldset>
          <legend class="text-lg font-semibold text-gray-800 mb-3">Collaboration Preference</legend>
          <div class="space-y-2">
            <label class="flex items-center gap-2 text-sm"><input type="radio" name="collaboration" value="Solo supervised project" class="h-4 w-4 text-blue-600 border-gray-300"> Solo supervised project</label>
            <label class="flex items-center gap-2 text-sm"><input type="radio" name="collaboration" value="Paired project" class="h-4 w-4 text-blue-600 border-gray-300"> Paired project</label>
            <label class="flex items-center gap-2 text-sm"><input type="radio" name="collaboration" value="Larger team" class="h-4 w-4 text-blue-600 border-gray-300"> Larger team</label>
          </div>
        </fieldset>
      </div>

      <!-- Submit -->
      <div class="flex flex-col-reverse sm:flex-row justify-end gap-3 border-t pt-6">
        <button type="button" id="cancelButton" class="px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold rounded-lg transition-colors text-center">Cancel</button>
        <button type="submit" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors text-center">Submit Application</button>
      </div>
    </form>

    <!-- Confirmation View (hidden initially) -->
    <div id="confirmationView" class="hidden overflow-y-auto p-6 sm:p-10">
      <div class="text-center py-8 sm:py-12">
        <!-- Animated check icon -->
        <div class="confirm-icon mx-auto mb-6 w-20 h-20 bg-green-100 rounded-full flex items-center justify-center">
          <svg class="check-animated w-10 h-10 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M5 13l4 4L19 7"/>
          </svg>
        </div>

        <h3 class="text-2xl font-bold text-gray-900 mb-2">Application Received!</h3>
        <p id="confirmProjectName" class="text-blue-700 font-semibold text-sm mb-6"></p>

        <p class="text-gray-600 max-w-md mx-auto mb-2">
          Thank you for your interest. The faculty lead will review your application and
          be in touch regarding next steps.
        </p>
        <p class="text-gray-500 text-sm max-w-md mx-auto mb-8">
          You should expect to hear back within 5–7 business days. If you have any
          questions in the meantime, feel free to reach out to the faculty lead directly.
        </p>

        <button type="button" id="confirmClose"
                class="px-8 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition-colors">
          Back to Projects
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ════════════════════ JAVASCRIPT ════════════════════ -->
<script>

/* ─── STATUS ORDER ─── */
const STATUS_ORDER = { Active: 1, Planning: 2, Completed: 3 };

/* ─── PROJECT DATA (29 rows) ─── */
const projectData = [
  {id:1,title:"AI-PACU Study: Clinical Decision Support for Discharge & Escalation",faculty:"Brian Pitts, MD, MS",trainees:"Josephine Du",type:"Research",description:"Development and evaluation of an AI-based decision support tool to aid PACU nurses with escalation and discharge decisions using EHR-derived data.",skills:"Interest in perioperative medicine; basic data literacy; optional Python/R",time:"2–4 hrs/week",residentSlots:0,studentSlots:2,status:"Active"},
  {id:2,title:"Stroke Thrombectomy Anesthesia Protocol",faculty:"Brian Pitts, MD, MS; Christian Bohringer, MD",trainees:"Michael Agarado",type:"QI",description:"Quality improvement project to streamline anesthesia workflows for mechanical thrombectomy to reduce treatment delays.",skills:"Interest in neuroanesthesia and systems improvement",time:"2 hrs/week",residentSlots:1,studentSlots:0,status:"Active"},
  {id:3,title:"BranchLab: Physiologic Airway Simulation",faculty:"Brian Pitts, MD, MS; Hannah Bechtold, MD",trainees:"Callum Rowe, MD; Derron Yu, MD; Ravina Brring, MD; Ellie Tsang",type:"Edu/Res",description:"Development of interactive, case-based simulations to teach physiologic airway management to anesthesia trainees.",skills:"Interest in education; optional UI/UX or web development",time:"Flexible",residentSlots:1,studentSlots:1,status:"Active"},
  {id:4,title:"Pediatric Anesthesia Safety Dashboard",faculty:"Faculty Lead TBD",trainees:"—",type:"QI",description:"Creation of a dashboard tracking perioperative safety metrics in pediatric anesthesia to support quality monitoring.",skills:"Basic data interpretation; interest in patient safety",time:"2–4 hrs/week",residentSlots:0,studentSlots:2,status:"Planning"},
  {id:5,title:"EVD Safety Campaign",faculty:"Faculty Lead TBD",trainees:"—",type:"QI",description:"Quality improvement initiative focused on improving safety practices surrounding external ventricular drain management.",skills:"Interest in neurosurgical or neurocritical care safety",time:"1–2 hrs/week",residentSlots:0,studentSlots:0,status:"Planning"},
  {id:6,title:"Patient self-reported duration of analgesia after shoulder surgery and interscalene block with and without perineural adjuncts",faculty:"Robin Aldwinckle, B.M.B.S., F.R.C.A.",trainees:"—",type:"Research",description:"Observational study assessing patient-reported analgesia duration following interscalene blocks with adjunct medications.",skills:"Interest in regional anesthesia; chart review skills",time:"1–2 hrs/week",residentSlots:0,studentSlots:1,status:"Active"},
  {id:7,title:"A comparison of 0.25% bupivacaine vs bupivacaine + clonidine/dexamethasone vs buprenorphine vs liposomal bupivacaine for outpatient arthroscopic shoulder surgery",faculty:"Robin Aldwinckle, B.M.B.S., F.R.C.A.",trainees:"—",type:"Research",description:"Comparative effectiveness study of local anesthetic strategies for postoperative pain control in shoulder surgery.",skills:"Interest in regional anesthesia; data abstraction",time:"1–2 hrs/week",residentSlots:0,studentSlots:1,status:"Active"},
  {id:8,title:"Evaluation of dynamic monitors for the prediction of volume responsiveness in patients with and without diastolic dysfunction",faculty:"Neal Fleming, MD, PhD",trainees:"—",type:"Research",description:"Physiologic study evaluating the accuracy of dynamic hemodynamic monitors in predicting fluid responsiveness.",skills:"Interest in cardiac physiology; basic statistics",time:"2 hrs/week",residentSlots:1,studentSlots:0,status:"Completed"},
  {id:9,title:"Do preoperative PECS I and II nerve blocks reduce post-mastectomy opioid consumption, LOS, and improve comfort?",faculty:"Jon Zhou, MD",trainees:"—",type:"Research",description:"Retrospective cohort study evaluating the impact of PECS blocks on postoperative outcomes after mastectomy.",skills:"Interest in regional anesthesia; chart review",time:"1–2 hrs/week",residentSlots:0,studentSlots:1,status:"Completed"},
  {id:10,title:"Transversus abdominus plane (TAP) blocks with ropivacaine continuous infusion catheters vs liposomal bupivacaine after renal transplant",faculty:"John Burston, M.B.B.S.",trainees:"—",type:"Clinical Trial",description:"Prospective randomized trial comparing continuous TAP catheters to liposomal bupivacaine for post-transplant analgesia.",skills:"Interest in clinical trials; patient follow-up",time:"2–3 hrs/week",residentSlots:1,studentSlots:0,status:"Completed"},
  {id:11,title:"Concurrent use of ultrasound-tagged near-infrared spectroscopy and near-infrared spectroscopy",faculty:"Bradlee Bachar",trainees:"—",type:"Research",description:"Feasibility and validation study combining ultrasound-tagged NIRS with standard NIRS monitoring.",skills:"Interest in monitoring technology",time:"1–2 hrs/week",residentSlots:0,studentSlots:1,status:"Active"},
  {id:12,title:"Post-operative opioid usage, adverse events, and LOS after TAP blocks in renal transplant patients",faculty:"Kristin Bennett, D.O.",trainees:"—",type:"Research",description:"Retrospective outcomes study examining opioid use and complications after TAP block utilization.",skills:"Chart review skills; interest in pain outcomes",time:"1–2 hrs/week",residentSlots:0,studentSlots:1,status:"Completed"},
  {id:13,title:"Effect of dexmedetomidine on postoperative recovery during low-income country cleft surgery missions",faculty:"Neal Fleming, MD, PhD",trainees:"—",type:"Research",description:"Observational study evaluating perioperative dexmedetomidine use during international surgical missions.",skills:"Interest in global health anesthesia",time:"1–2 hrs/week",residentSlots:1,studentSlots:0,status:"Completed"},
  {id:14,title:"Sugammadex: Impact on Practice and Outcomes",faculty:"Neal Fleming, MD, PhD",trainees:"—",type:"Research",description:"Assessment of clinical practice changes and outcomes following the introduction of sugammadex.",skills:"Interest in outcomes research",time:"1–2 hrs/week",residentSlots:1,studentSlots:0,status:"Completed"},
  {id:15,title:"Effects of IV fluid bolus on assessment of left ventricular diastolic function",faculty:"Neal Fleming, MD, PhD",trainees:"—",type:"Research",description:"Physiologic echocardiography-based study examining how fluid boluses alter diastolic measurements.",skills:"Interest in cardiac ultrasound",time:"2 hrs/week",residentSlots:1,studentSlots:0,status:"Completed"},
  {id:16,title:"Comparing Continuous Cardiac Output Monitors in Cardiothoracic Surgery",faculty:"Neal Fleming, MD, PhD",trainees:"—",type:"Research",description:"Comparative evaluation of continuous cardiac output monitoring devices during cardiac surgery.",skills:"Interest in cardiothoracic anesthesia",time:"2 hrs/week",residentSlots:1,studentSlots:0,status:"Completed"},
  {id:17,title:"Comparing Dynamic Parameters of Continuous Cardiac Function Monitors in Cardiothoracic Surgery",faculty:"Neal Fleming, MD, PhD",trainees:"—",type:"Research",description:"Study comparing dynamic cardiac performance parameters across monitoring platforms.",skills:"Interest in hemodynamics",time:"2 hrs/week",residentSlots:1,studentSlots:0,status:"Completed"},
  {id:18,title:"Impact of the introduction of Sugammadex on 30-day postoperative readmission rates",faculty:"Neal Fleming, MD, PhD",trainees:"—",type:"Research",description:"Retrospective outcomes study examining readmission rates after sugammadex adoption.",skills:"Basic statistics; chart review",time:"1–2 hrs/week",residentSlots:1,studentSlots:0,status:"Completed"},
  {id:19,title:"Impact of the introduction of Sugammadex on provider practice and PACU ventilation",faculty:"Neal Fleming, MD, PhD",trainees:"—",type:"Research",description:"Practice-pattern analysis of neuromuscular reversal strategies and PACU ventilation.",skills:"Interest in perioperative workflow",time:"1–2 hrs/week",residentSlots:1,studentSlots:0,status:"Completed"},
  {id:20,title:"Infant memory, visual attention, and cognitive testing pre- and post-anesthesia",faculty:"Cathy Lammers, MD",trainees:"—",type:"Research",description:"Prospective neurodevelopmental assessment study in infants undergoing anesthesia.",skills:"Interest in pediatric anesthesia research",time:"2 hrs/week",residentSlots:0,studentSlots:1,status:"Active"},
  {id:21,title:"The perioperative use of hemodynamic monitor devices and surgical outcomes",faculty:"Hong Liu, MD",trainees:"—",type:"Research",description:"Large-scale observational study linking hemodynamic monitoring strategies to surgical outcomes.",skills:"Data analysis interest",time:"2–3 hrs/week",residentSlots:1,studentSlots:0,status:"Active"},
  {id:22,title:"Dexmedetomidine and renal transplants",faculty:"Hong Liu, MD",trainees:"—",type:"Research",description:"Evaluation of dexmedetomidine use and outcomes in renal transplant recipients.",skills:"Interest in transplant anesthesia",time:"1–2 hrs/week",residentSlots:1,studentSlots:0,status:"Active"},
  {id:23,title:"Impact of race in perioperative pain management in pediatric tonsillectomy and adenoidectomy",faculty:"Niroop Ravula, M.B.B.S., F.R.C.A.",trainees:"—",type:"Research",description:"Health equity study examining racial disparities in perioperative pain management.",skills:"Interest in disparities research",time:"1–2 hrs/week",residentSlots:0,studentSlots:1,status:"Active"},
  {id:24,title:"Minimally invasive hemodynamic monitors during acute normovolemic hemodilution",faculty:"Neal Fleming, MD, PhD",trainees:"—",type:"Research",description:"Physiologic study of minimally invasive monitors during controlled hemodilution.",skills:"Interest in hemodynamic physiology",time:"2 hrs/week",residentSlots:1,studentSlots:0,status:"Completed"},
  {id:25,title:"Does Video-Assisted Self Review Help Students Learn a New Skill Faster?",faculty:"Neal Fleming, MD, PhD; Brian Pitts, MD, MEd",trainees:"—",type:"Edu/Res",description:"Educational research study evaluating video-assisted self-review for procedural skill acquisition.",skills:"Interest in medical education",time:"1–2 hrs/week",residentSlots:0,studentSlots:1,status:"Completed"},
  {id:26,title:"Non-diagnostic serum troponin as a marker for perioperative risk",faculty:"Neal Fleming, MD, PhD",trainees:"—",type:"Research",description:"Outcomes study assessing prognostic value of low-level perioperative troponin elevations.",skills:"Basic statistics",time:"1–2 hrs/week",residentSlots:1,studentSlots:0,status:"Completed"},
  {id:27,title:"Modified pre-operative oral acetaminophen vs intravenous acetaminophen",faculty:"Cathy Lammers, MD",trainees:"—",type:"Research",description:"Comparative study of oral versus IV acetaminophen for perioperative analgesia.",skills:"Interest in pain management",time:"1–2 hrs/week",residentSlots:0,studentSlots:1,status:"Active"},
  {id:28,title:"Etomidate + propofol vs etomidate vs propofol for induction: pilot observational study",faculty:"Hong Liu, MD",trainees:"—",type:"Research",description:"Pilot observational study comparing induction agent strategies.",skills:"Interest in anesthetic pharmacology",time:"1–2 hrs/week",residentSlots:1,studentSlots:0,status:"Active"},
  {id:29,title:"TAP block catheters vs liposomal bupivacaine after colorectal surgery",faculty:"Jon Zhou, MD",trainees:"—",type:"Clinical Trial",description:"Prospective randomized trial evaluating analgesic strategies after colorectal surgery.",skills:"Interest in clinical trials",time:"2–3 hrs/week",residentSlots:1,studentSlots:0,status:"Completed"}
];

/* ─── DOM REFS ─── */
const tableBodyDesktop = document.getElementById("table-body-desktop");
const cardContainer    = document.getElementById("card-container");
const noDesktop        = document.getElementById("no-results-desktop");
const noMobile         = document.getElementById("no-results-mobile");
const searchInput      = document.getElementById("searchInput");
const modal            = document.getElementById("signupModal");
const modalHeader      = document.getElementById("modalHeader");
const modalTitle       = document.getElementById("modalProjectTitle");
const hiddenTitle      = document.getElementById("projectTitleInput");
const signupForm       = document.getElementById("signupForm");
const confirmationView = document.getElementById("confirmationView");
const confirmProjectName = document.getElementById("confirmProjectName");

/* ─── DROPDOWN TOGGLE ─── */
function toggleDropdown(id) {
  const panel = document.getElementById(id);
  document.querySelectorAll('.dropdown-panel').forEach(p => {
    if (p.id !== id) p.classList.remove('open');
  });
  panel.classList.toggle('open');
}
document.addEventListener('click', e => {
  if (!e.target.closest('#typeDropdownWrap'))   document.getElementById('typeDropdown').classList.remove('open');
  if (!e.target.closest('#statusDropdownWrap')) document.getElementById('statusDropdown').classList.remove('open');
});
document.getElementById('typeTrigger').addEventListener('click',   () => toggleDropdown('typeDropdown'));
document.getElementById('statusTrigger').addEventListener('click', () => toggleDropdown('statusDropdown'));

function setAll(cls, val) {
  document.querySelectorAll(`.${cls}`).forEach(cb => cb.checked = val);
  filterAndRender();
}

/* ─── BADGE COLOURS ─── */
function statusBadge(s) {
  return ({ Active:"bg-blue-100 text-blue-800", Planning:"bg-amber-100 text-amber-800", Completed:"bg-green-100 text-green-800" })[s] || "bg-gray-100 text-gray-800";
}
function typeBadge(t) {
  return ({ Research:"bg-emerald-100 text-emerald-800", QI:"bg-indigo-100 text-indigo-800", "Edu/Res":"bg-yellow-100 text-yellow-800", "Clinical Trial":"bg-pink-100 text-pink-800" })[t] || "bg-gray-100 text-gray-800";
}

/* ─── RENDER ─── */
function renderAll(data) {
  const sorted = [...data].sort((a, b) => (STATUS_ORDER[a.status]||99) - (STATUS_ORDER[b.status]||99));

  /* Desktop table */
  tableBodyDesktop.innerHTML = "";
  /* Mobile cards */
  cardContainer.innerHTML = "";

  if (!sorted.length) {
    noDesktop.classList.remove("hidden");
    noMobile.classList.remove("hidden");
    return;
  }
  noDesktop.classList.add("hidden");
  noMobile.classList.add("hidden");

  sorted.forEach(p => {
    const total  = p.residentSlots + p.studentSlots;
    const closed = p.status === "Completed" || total === 0;
    const muted  = p.status === "Completed";
    const esc    = p.title.replace(/"/g, '&quot;');

    /* ── Desktop row ── */
    const row = document.createElement("tr");
    row.className = `hover:bg-gray-50 ${muted ? "text-gray-400" : ""}`;
    row.innerHTML = `
      <td class="px-4 py-3 overflow-hidden">
        <div class="text-sm font-semibold ${muted ? 'text-gray-400' : 'text-gray-900'} line-clamp-2">${p.title}</div>
        <div class="text-xs text-gray-400 mt-0.5">${p.time}</div>
      </td>
      <td class="px-4 py-3 text-sm font-medium overflow-hidden"><div class="line-clamp-2">${p.faculty}</div></td>
      <td class="px-4 py-3 text-sm overflow-hidden"><div class="line-clamp-2">${p.trainees}</div></td>
      <td class="px-1 py-3"><span class="block mx-0.5 py-0.5 text-xs leading-5 font-semibold rounded-full text-center whitespace-nowrap ${typeBadge(p.type)}">${p.type}</span></td>
      <td class="px-1 py-3"><span class="block mx-0.5 py-0.5 text-xs leading-5 font-semibold rounded-full text-center whitespace-nowrap ${statusBadge(p.status)}">${p.status}</span></td>
      <td class="px-4 py-3 text-sm overflow-hidden">
        <div class="line-clamp-3">${p.description}</div>
        <div class="text-xs text-gray-400 mt-1 line-clamp-1">Skills: ${p.skills}</div>
      </td>
      <td class="px-4 py-3 text-center">
        <div class="text-sm font-semibold">${total}</div>
        <div class="text-xs text-gray-400">R:${p.residentSlots} / MS:${p.studentSlots}</div>
      </td>
      <td class="px-4 py-3 text-right">
        <button class="apply-btn px-3 py-1.5 text-xs font-semibold rounded-lg transition-colors shadow-sm whitespace-nowrap
          ${closed ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700 text-white'}"
          data-title="${esc}" ${closed ? "disabled" : ""}>
          ${closed ? "Closed" : "Apply"}
        </button>
      </td>`;
    tableBodyDesktop.appendChild(row);

    /* ── Mobile card ── */
    const card = document.createElement("div");
    card.className = `bg-white rounded-lg shadow-sm border p-4 ${muted ? 'opacity-60' : ''}`;
    card.innerHTML = `
      <div class="flex items-start justify-between gap-3 mb-2">
        <h3 class="text-sm font-semibold ${muted ? 'text-gray-400' : 'text-gray-900'} leading-snug flex-1">${p.title}</h3>
        <button class="apply-btn shrink-0 px-3 py-1.5 text-xs font-semibold rounded-lg transition-colors shadow-sm
          ${closed ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700 text-white'}"
          data-title="${esc}" ${closed ? "disabled" : ""}>
          ${closed ? "Closed" : "Apply"}
        </button>
      </div>
      <div class="flex flex-wrap gap-1.5 mb-3">
        <span class="px-2 py-0.5 text-xs font-semibold rounded-full ${typeBadge(p.type)}">${p.type}</span>
        <span class="px-2 py-0.5 text-xs font-semibold rounded-full ${statusBadge(p.status)}">${p.status}</span>
        <span class="px-2 py-0.5 text-xs font-medium rounded-full bg-gray-100 text-gray-600">${p.time}</span>
        <span class="px-2 py-0.5 text-xs font-medium rounded-full bg-gray-100 text-gray-600">Slots: ${total} (R:${p.residentSlots} / MS:${p.studentSlots})</span>
      </div>
      <p class="text-sm text-gray-700 mb-2">${p.description}</p>
      <div class="text-xs text-gray-500 space-y-1">
        <p><span class="font-medium text-gray-600">Faculty:</span> ${p.faculty}</p>
        ${p.trainees !== '—' ? `<p><span class="font-medium text-gray-600">Trainees:</span> ${p.trainees}</p>` : ''}
        <p><span class="font-medium text-gray-600">Skills:</span> ${p.skills}</p>
      </div>`;
    cardContainer.appendChild(card);
  });

  /* Wire ALL apply buttons (desktop + mobile) */
  document.querySelectorAll('.apply-btn:not([disabled])').forEach(btn => {
    btn.addEventListener('click', () => openModal(btn.dataset.title));
  });
}

/* ─── LABELS ─── */
function updateLabels() {
  const types = getChecked('typeCheck'), statuses = getChecked('statusCheck');
  const at = document.querySelectorAll('.typeCheck').length;
  const as = document.querySelectorAll('.statusCheck').length;
  document.getElementById('typeLabel').textContent   = types.length === 0 ? 'No Types' : types.length === at ? 'All Project Types' : types.join(', ');
  document.getElementById('statusLabel').textContent = statuses.length === 0 ? 'No Statuses' : statuses.length === as ? 'All Statuses' : statuses.join(', ');
}

/* ─── FILTER ─── */
function getChecked(cls) { return [...document.querySelectorAll(`.${cls}:checked`)].map(c => c.value); }

function filterAndRender() {
  const term = searchInput.value.toLowerCase().trim();
  const types = getChecked('typeCheck'), statuses = getChecked('statusCheck');
  const filtered = projectData.filter(p =>
    (!term || p.title.toLowerCase().includes(term) || p.faculty.toLowerCase().includes(term) || p.description.toLowerCase().includes(term) || p.trainees.toLowerCase().includes(term) || p.skills.toLowerCase().includes(term)) &&
    (!types.length   || types.includes(p.type)) &&
    (!statuses.length || statuses.includes(p.status))
  );
  updateLabels();
  renderAll(filtered);
}

/* ─── MODAL ─── */
function showFormView() {
  signupForm.classList.remove('hidden');
  confirmationView.classList.add('hidden');
  modalHeader.classList.remove('hidden');
}
function showConfirmView(title) {
  signupForm.classList.add('hidden');
  modalHeader.classList.add('hidden');
  confirmationView.classList.remove('hidden');
  confirmProjectName.textContent = title;
}

function openModal(title) {
  showFormView();
  modalTitle.textContent = `Applying for: ${title}`;
  hiddenTitle.value = title;
  signupForm.reset();
  signupForm.querySelector('[name="date"]').value = new Date().toISOString().split('T')[0];

  modal.classList.remove('hidden');
  requestAnimationFrame(() => {
    modal.classList.remove('opacity-0');
    modal.querySelector('.modal-content').classList.remove('-translate-y-10');
  });
}

function closeModal() {
  modal.classList.add('opacity-0');
  modal.querySelector('.modal-content').classList.add('-translate-y-10');
  setTimeout(() => { modal.classList.add('hidden'); showFormView(); }, 250);
}

document.getElementById('closeModal').addEventListener('click', closeModal);
document.getElementById('cancelButton').addEventListener('click', closeModal);
document.getElementById('confirmClose').addEventListener('click', closeModal);
modal.addEventListener('click', e => { if (e.target === modal) closeModal(); });
document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

signupForm.addEventListener('submit', e => {
  e.preventDefault();
  const fd   = new FormData(signupForm);
  const data = Object.fromEntries(fd.entries());
  data.preferences  = fd.getAll('preferences');
  data.deliverables = fd.getAll('deliverables');
  console.log('--- Application Submitted ---', JSON.stringify(data, null, 2));

  showConfirmView(hiddenTitle.value);
});

/* ─── INIT ─── */
renderAll(projectData);
searchInput.addEventListener('input', filterAndRender);
document.querySelectorAll('.typeCheck, .statusCheck').forEach(cb => cb.addEventListener('change', filterAndRender));
</script>

</body>
</html>
